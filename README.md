# âœ¨ğŸ¦‹ illufly

[![PyPI version](https://img.shields.io/pypi/v/illufly.svg)](https://pypi.org/project/illufly/)

`illufly` æ˜¯ `illution butterfly` çš„ç¼©å†™ï¼Œä¸­æ–‡ä¸º"å¹»è¶"ã€‚

**illufly** æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨å¹¶å…·æœ‰è‡ªæˆ‘è¿›åŒ–èƒ½åŠ›çš„æ™ºèƒ½ä½“åº”ç”¨æ¡†æ¶ã€‚

æˆ‘ä»¬åœ¨ä½¿ç”¨ AI æ—¶éƒ½ä¼šæŠ¥ä»¥å¹»æƒ³ï¼Œå¸Œæœ›å®ƒèƒ½éšç€æ—¶é—´æ¨ç§»ä»å°ç™½å˜æˆè€æ‰‹ã€‚<br>
ä½†æˆ‘ä»¬ä¹Ÿå¸Œæœ›è¿™ä¸ªè¿›åŒ–è¿‡ç¨‹ä¸ç”¨æ“å¤ªå¤šå¿ƒï¼Œè€Œæ˜¯åƒå°å­©å­æ…¢æ…¢é•¿å¤§ä¸€æ ·ï¼Œè‡ªç„¶è€Œç„¶åœ°å®Œæˆã€‚

è¿™æ­£æ˜¯ `illufly` çš„è®¾è®¡ç†å¿µã€‚

ç›®å‰ `illufly` éšç€ç‰ˆæœ¬è¿­ä»£ï¼Œå·²ç»æ”¯æŒäº† RAGåº”ç”¨ã€å¤šç§æ™ºèƒ½ä½“æ¨ç†æ¨¡å¼ï¼Œå¹¶å…·æœ‰äº†ä¸€å®šçš„è¿›åŒ–èƒ½åŠ›ã€‚

* [ã€Šillufly å¿«é€ŸæŒ‡å—ã€‹](https://github.com/arcstep/illufly/wiki/Home)

**å…¥é—¨æŒ‡å—**
* [å®‰è£…é…ç½®æŒ‡å—](https://github.com/arcstep/illufly/wiki/å®‰è£…æŒ‡å—)
* [æ¨¡å—å¯¼å…¥å‚è€ƒ](https://github.com/arcstep/illufly/wiki/æ¨¡å—å‚è€ƒ)
* [å¼€ç®±å³ç”¨çš„æµè¾“å‡º](https://github.com/arcstep/illufly/wiki/æµè¾“å‡º)
* [å¤§æ¨¡å‹æ”¯æŒ](https://github.com/arcstep/illufly/wiki/æ¨¡å‹åˆ—è¡¨)
* [ä½¿ç”¨æ£€ç´¢å¢å¼ºï¼ˆRAGï¼‰](https://github.com/arcstep/illufly/wiki/RAG)

**å®è·µæ¡ˆä¾‹**
* [è¿ç»­å¯¹è¯æ¡ˆä¾‹](https://github.com/arcstep/illufly/wiki/å¯¹è¯)
* [é•¿æ–‡å†™ä½œæ¡ˆä¾‹](https://github.com/arcstep/illufly/wiki/é•¿æ–‡å†™ä½œ)
* [å¤šæ™ºèƒ½ä½“åä½œæ¡ˆä¾‹](https://github.com/arcstep/illufly/wiki/å¤šæ™ºèƒ½ä½“)

**é«˜çº§ä¸»é¢˜**
* [illufly çš„è®¾è®¡ç†å¿µ](https://github.com/arcstep/illufly/wiki/è®¾è®¡ç†å¿µ)
* [illufly çš„å·¥ä½œæµè®¾è®¡](https://github.com/arcstep/illufly/wiki/å·¥ä½œæµ)
* [illufly çš„æ¨ç†æ¨¡å¼å®ç°](https://github.com/arcstep/illufly/wiki/æ¨ç†æ¨¡å¼)
* [è‡ªå®šä¹‰æç¤ºè¯­æ¨¡æ¿](https://github.com/arcstep/illufly/wiki/æç¤ºè¯­æ¨¡æ¿)
* [è‡ªå®šä¹‰å¤§æ¨¡å‹](https://github.com/arcstep/illufly/wiki/è‡ªå®šä¹‰å¤§æ¨¡å‹)


## ä½¿ç”¨ç¤ºä¾‹

**1. åŸºæœ¬ä½¿ç”¨**

åœ¨äº†è§£ illufly çš„è¿›åŒ–èƒ½åŠ›ä¹‹å‰ï¼Œä½ åº”å½“å…ˆäº†è§£å®ƒçš„åŸºæœ¬ä½¿ç”¨ã€‚

illufly æœ€ä¸»è¦æ˜¯å°è£…äº† ChatAgent åŸºç±»ï¼Œåœ¨è¿›ä¸€æ­¥å®ç°åƒé—®ã€æ™ºè°±ä»¥åŠ OpenAI ç­‰å¤§æ¨¡å‹å‚å®¶çš„æ¥å£åï¼Œè·å¾—äº† ChatQwenã€ChatZhipu ä»¥åŠ ChatOpenAI ç­‰å­ç±»ã€‚

ç”±äº ChatAgent å°è£…äº†å¤šè½®å¯¹è¯ã€å·¥å…·å›è°ƒã€æµè¾“å‡ºç­‰å¸¸ç”¨èƒ½åŠ›ï¼ŒChatQwen ç­‰å­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›èƒ½åŠ›ã€‚

```python
from illufly.chat import ChatQwen

chat = ChatQwen()
chat("ä½ æ˜¯ä»€ä¹ˆæ¨¡å‹ï¼Ÿ")
```

```
è¾“å‡ºå†…å®¹: (æˆ‘æ˜¯ä¸€ä¸ªæµå¼è¾“å‡ºçš„åŠ¨ç”»)
```

**2. è®©ä½ çš„ AI è¶ŠèŠè¶Šæ‡‚**

åŸºæœ¬çš„è¿›åŒ–ç­–ç•¥æ˜¯ï¼šä½ è·Ÿ AI èŠçš„å†…å®¹å¯ä»¥è¢«å®ƒè®°ä½ï¼Œå¹¶æ ¹æ®è¿™äº›è®°å¿†è¿›åŒ–å‡ºè¶Šæ¥è¶Šæ‡‚ä½ çš„èƒ½åŠ›ã€‚<br>
ä½†å®é™…ä¸Šä½ ä¹Ÿä¸æƒ³æŠŠ AI å˜æˆä¸€åªè®°ä½ä»»ä½•äººè¯´è¯çš„é¹¦é¹‰ã€‚ä½ çš„ AI åº”å½“èƒ½å¤Ÿåˆ†è¾¨è¯¥è®°ä½è°çš„è¯ã€è®°ä½ä»€ä¹ˆè¯ã€‚



**2. å·¥å…·å›è°ƒ**

ChatAgent åœ¨ä½¿ç”¨å·¥å…·å›è°ƒæ—¶éå¸¸ç®€æ´ï¼Œåªéœ€è¦å°†å·¥å…·åˆ—è¡¨ä¼ é€’ç»™ç±»çš„å®ä¾‹å³å¯ï¼Œä¸éœ€è¦å¤šä½™çš„ä»£ç ã€‚

```python
from illufly.chat import ChatQwen

def poet(input: str):
    """æˆ‘æ˜¯è¯—äººï¼Œæ“…é•¿ä½œè¯—ã€‚"""
    return "è¯·çœ‹æˆ‘çš„æ–°ä½œï¼š\nå¤§æµ·å•Š, å…¨æ˜¯æ°´"

chat = ChatQwen(tools=[poet])
chat("å¸®æˆ‘å†™ä¸€é¦–å°è¯—ï¼Ÿ")
```

    ä¸Šè¿°ä»£ç ä¼šè§¦å‘ openai çš„å·¥å…·å›è°ƒï¼Œå¹¶å°† poet åšçš„è¯—ä½œä¸ºç»“æœè¿”å›ç»™ä½ ã€‚

**3. å¤æ‚æ¨ç†**

ä½ å·²ç»å­¦ä¼šç›´æ¥ä½¿ç”¨ OpenAI é£æ ¼çš„å·¥å…·å›è°ƒã€‚<br>
ä½†ä½ å¯èƒ½è¿˜æƒ³ä½¿ç”¨å…¶ä»–æ¨ç†æ¨¡å¼ï¼Œillufly ä¸­å·²ç»å®ç°è¿™äº›æ¨ç†é£æ ¼:

| FlowAgentå­ç±» | æ¨ç†æ–¹å¼ | è®ºæ–‡ |
|:----|:--------|:------------|
|ReAct|ä¸€è¾¹æ¨ç†ä¸€è¾¹æ‰§è¡Œ|[ReAct](https://arxiv.org/abs/2210.03629) |
|ReWOO|ä¸€æ¬¡æ€§è§„åˆ’æ‰€æœ‰æ­¥éª¤åä¸€èµ·æ‰§è¡Œ|[ReWOO](https://arxiv.org/abs/2305.18323) |
|PlanAndSolve|ä¸€è¾¹ä¿®è®¢æ€»ä½“è®¡åˆ’ä¸€è¾¹æ‰§è¡Œ|[Plan-and-Solve](https://arxiv.org/abs/2305.04091) |

ä½ ä¹Ÿå¯ä»¥å‚è€ƒ illufly çš„æºç ï¼Œå®ç°è‡ªå·±çš„æ¨ç†æ¨¡å¼ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ª ReAct ä½¿ç”¨çš„ç¤ºä¾‹ï¼Œä¸ç›´æ¥ä½¿ç”¨ ChatAgent éå¸¸ç›¸ä¼¼ï¼š

```python
from illufly.chat import ChatQwen, ReAct

def tool1(input: str):
    """æˆ‘æ˜¯ä¸€ä¸ªä¼šå†™è¯—çš„å·¥å…·"""
    return "å¤§æµ·å•Š, å…¨æ˜¯æ°´"

chat = ReAct(
    planner=ChatQwen(tools=[tool1])
)
chat("ä½ æ˜¯ä»€ä¹ˆæ¨¡å‹ï¼Ÿ")
```

**4. å¤šæ™ºèƒ½ä½“åä½œ**

illufly ä¹Ÿå…è®¸ä½ å®šä¹‰å¤šä¸ªæ™ºèƒ½ä½“ï¼Œå¹¶è®©å®ƒä»¬åä½œå®Œæˆä»»åŠ¡ã€‚

ä¸‹é¢çš„ FlowAgent ä»£ç å®ç°äº† **Reflection** æ¨ç†æ¨¡å¼ã€‚
ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ªæ¡ä»¶å¾ªç¯ï¼Œå†™æ‰‹å’Œè¯„åˆ†ä¸“å®¶åä½œå®Œæˆä¸€é¦–å„¿æ­Œçš„åˆ›ä½œå’Œè¯„åˆ†ã€‚

```python
from illufly.chat import FlowAgent, ChatQwen, Selector

writer = ChatQwen(
    name="å†™æ‰‹",
    memory=("system", "ä½ æ˜¯ä¸€ä¸ªå†™æ‰‹")
)

evaluator = ChatQwen(
    name="è¯„åˆ†ä¸“å®¶",
    memory=("system", "ä½ æ˜¯ä¸€ä¸ªè¯„åˆ†ä¸“å®¶ï¼Œæ ¹æ®å¯¹æ–¹å†™çš„å†…å®¹è¯„ä»·1åˆ†-5åˆ†ï¼Œä»…è¾“å‡ºè¯„ä»·å’Œæœ€ç»ˆç»“æœ")
)

def should_continue():
    return "__END__" if "5" in evaluator.last_output else "å†™æ‰‹"

flow = FlowAgent(writer, evaluator, Selector(condition=should_continue))

flow("ä½ èƒ½å¸®æˆ‘å†™ä¸€é¦–å…³äºå…”å­çš„å››å¥å„¿æ­Œ?")
```

## çŸ¥è¯†å¡”

å¦‚æœä½ æƒ³å­¦ä¹  illufly çš„å…¨éƒ¨å†…å®¹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªçŸ¥è¯†ç»“æ„çš„æŒ‡å¼•ã€‚

è¯¥å›¾ä¸æ˜¯æ¨¡å—çš„ç»§æ‰¿å…³ç³»ï¼Œè€Œæ˜¯çŸ¥è¯†ä¸»é¢˜çš„ä¾èµ–å…³ç³»ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ è¦äº†è§£æŸä¸ªä¸Šå±‚æ¨¡å—ï¼Œå°±å¿…é¡»å…ˆäº†è§£ä¸‹å±‚æ¨¡å—ã€‚

```mermaid
graph TD
    Config[[Config<br>ç¯å¢ƒå˜é‡/é»˜è®¤é…ç½®]]
    Runnable[Runnable<br>ç»‘å®šæœºåˆ¶/æµè¾“å‡º/handler]

    Flow[FlowAgent<br>é¡ºåº/åˆ†æ”¯/å¾ªç¯/è‡ªå®šä¹‰]

    Agent(ChatAgent<br>è®°å¿†/å·¥å…·/è¿›åŒ–)
    Selector(Selector<br>æ„å›¾/æ¡ä»¶)
    BaseAgent(BaseAgent<br>å·¥å…·/å¤šæ¨¡æ€)
    Messages[Messages<br>æ–‡æœ¬/å¤šæ¨¡æ€/æ¨¡æ¿]
    PromptTemplate[[PromptTemplate<br>æ¨¡æ¿è¯­æ³•/hub]]

    MarkMeta[[MarkMeta<br>åˆ‡åˆ†æ ‡è®°/å…ƒæ•°æ®åºåˆ—åŒ–]]
    Retriever[Retriever<br>ç†è§£/æŸ¥è¯¢/æ•´ç†]

    Flow --> Agent
    Agent --> Selector --> Runnable --> Config
    Agent --> BaseAgent --> Runnable
    Agent --> Messages -->  PromptTemplate --> Runnable
    Agent --> Retriever --> MarkMeta --> Runnable

    style Agent stroke-width:2px,stroke-dasharray:5 5
    style BaseAgent stroke-width:2px,stroke-dasharray:5 5

```

## å®‰è£…æŒ‡å—

**å®‰è£… `illufly` åŒ…**

```sh
pip install illufly
```

**æ¨èä½¿ç”¨ `dotenv` ç®¡ç†ç¯å¢ƒå˜é‡**

å°†`APIKEY`å’Œé¡¹ç›®é…ç½®ä¿å­˜åˆ°`.env`æ–‡ä»¶ï¼Œå†åŠ è½½åˆ°è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™æ˜¯å¾ˆå¥½çš„å®è·µç­–ç•¥ã€‚

```
## OpenAI å…¼å®¹çš„é…ç½®
OPENAI_API_KEY="ä½ çš„API_KEY"
OPENAI_BASE_URL="ä½ çš„BASE_URL"

## é˜¿é‡Œäº‘çš„é…ç½®
DASHSCOPE_API_KEY="ä½ çš„API_KEY"

## æ™ºè°±AIçš„é…ç½®
ZHIPUAI_API_KEY="ä½ çš„API_KEY"
```

åœ¨ Python ä»£ç ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹ä»£ç ç‰‡æ®µæ¥åŠ è½½`.env`æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ï¼š

```python
from dotenv import load_dotenv, find_dotenv
load_dotenv(find_dotenv(), override=True)
```



