(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[386,792],{41226:()=>{},83571:(e,t,s)=>{Promise.resolve().then(s.bind(s,31571))},31571:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var a=s(95155),r=s(12115),i=s(86084),n=s(86828);let o=(0,r.createContext)({apikeys:[],imitators:[],createApikey:async()=>{throw Error("ApikeysProvider not found")},listApikeys:async()=>{throw Error("ApikeysProvider not found")},revokeApikey:async()=>{throw Error("ApikeysProvider not found")}});function l(e){let{children:t}=e,[s,i]=(0,r.useState)(!0),[l,c]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),h=async()=>{try{let e="".concat(n.J,"/imitators"),t=await fetch(e,{method:"GET",credentials:"include"});if(t.ok){let e=await t.json();console.log("imitators response >>> ",e),e&&e.imitators&&Array.isArray(e.imitators)?u(e.imitators):Array.isArray(e)?u(e):(console.error("imitators数据格式不正确",e),u(["OPENAI","QWEN","ZHIPU"]))}else console.error("获取imitators失败",t.status),u(["OPENAI","QWEN","ZHIPU"])}catch(e){console.error("获取imitators出错:",e),u(["OPENAI","QWEN","ZHIPU"])}};(0,r.useEffect)(()=>{h().then(()=>{m()})},[]);let x=async(e,t)=>{let s="".concat(n.J,"/apikeys");try{i(!0);let a=await fetch(s,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({description:e,imitator:t}),credentials:"include"});if(a.ok){let e=await a.json();return console.log("apikey >>> ",e),await m(),e.apikey}throw console.log("创建 APIKEY 失败"),Error("创建 APIKEY 失败")}catch(e){throw console.error("创建 APIKEY 失败:",{error:e}),e}finally{i(!1)}},p=async e=>{let t="".concat(n.J,"/apikeys/revoke/").concat(e);try{i(!0),(await fetch(t,{method:"POST",credentials:"include"})).ok?console.log("撤销 APIKEY 成功"):console.log("撤销 APIKEY 失败")}catch(e){console.error("撤销 APIKEY 失败:",{error:e})}finally{i(!1)}},m=async()=>{let e="".concat(n.J,"/apikeys");try{i(!0);let t=await fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",signal:AbortSignal.timeout(8e3)});if(t.ok){let e=await t.json();console.log("apikeys_list >>> ",e),c(e)}else console.log("获取 APIKEYS 失败")}catch(t){console.error("获取 APIKEYS 失败:",{error:t,message:t instanceof Error?t.message:"未知错误",api_url:e})}finally{i(!1)}};return s?(0,a.jsx)("div",{children:"Loading..."}):(0,a.jsx)(o.Provider,{value:{apikeys:l,imitators:d,createApikey:x,listApikeys:m,revokeApikey:p},children:t})}var c=s(68435),d=s(69253);function u(){return(0,a.jsx)("div",{className:"p-5 h-screen flex flex-col",children:(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(l,{children:(0,a.jsx)(h,{})})})})}function h(){let{changeCurrentPath:e,isAuthenticated:t}=(0,c.A)(),{apikeys:s,imitators:n,createApikey:l,listApikeys:u,revokeApikey:h}=function(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useApikeys must be used within an ApikeysProvider");return e}(),[x,p]=(0,r.useState)(""),[m,y]=(0,r.useState)(""),[g,f]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{e("/apikeys")},[]),!t)return(0,a.jsx)("div",{children:"Loading..."});(0,r.useEffect)(()=>{n&&n.length>0&&!m&&y(n[0])},[n,m]);let w=async()=>{if(x.trim()&&m){f(!0);try{let e=await l(x,m);console.log("apiKey >>> ",e),p(""),await u()}catch(e){console.error("创建API密钥失败:",e)}finally{f(!1)}}},j=async e=>{window.confirm("确定要撤销此API密钥吗？此操作无法撤销。")&&(await h(e),await u())};return console.log("apikeys >>> ",s),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"OpenAI 兼容接口的 API密钥管理"}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"创建新API密钥"}),(0,a.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"大模型提供方"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-4",children:n&&n.map(e=>(0,a.jsxs)("label",{className:"inline-flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"imitator",value:e,checked:m===e,onChange:()=>y(e),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500"}),(0,a.jsx)("span",{className:"ml-2",children:e})]},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"描述（用途）"}),(0,a.jsx)("input",{type:"text",value:x,onChange:e=>p(e.target.value),className:"mt-1 p-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"例如：网站集成、移动应用等"})]}),(0,a.jsx)("button",{onClick:w,disabled:g||!x.trim()||!m,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-300",children:g?"创建中...":"创建API密钥"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold p-4 border-b",children:"您的API密钥"}),void 0==s||0===s.length?(0,a.jsx)("div",{className:"p-6 text-center text-gray-500",children:"您还没有创建任何API密钥"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"用途"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"API_KEY"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"BASE_URL"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"过期时间"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.description}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(0,a.jsxs)("span",{className:"mr-2 text-sm flex-1 overflow-x-auto",children:[e.api_key.slice(0,8),"...",e.api_key.slice(-8)]}),(0,a.jsx)(i.A,{content:e.api_key})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(0,a.jsx)("span",{className:"mr-2 text-sm flex-1 overflow-x-auto",children:e.base_url}),(0,a.jsx)(i.A,{content:e.base_url})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.expires_at?(0,d.GP)(new Date(1e3*e.expires_at),"yyyy-MM-dd HH:mm"):"永不过期"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.is_expired?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.is_expired?"已过期":"有效"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)("button",{onClick:()=>j(e.api_key),className:"text-red-600 hover:text-red-900",children:"撤销"})})]},e.api_key))})]})})]})]})}},86084:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(95155),r=s(12115),i=s(9757),n=s(95055);function o(e){let{content:t,getContent:s}=e,[o,l]=(0,r.useState)({show:!1,position:{x:0,y:0}}),[c,d]=(0,r.useState)(!1),u=async e=>{let a=t;if("function"==typeof s&&!t){d(!0);try{a=await s()}catch(e){console.error("获取复制内容失败:",e);return}finally{d(!1)}}navigator.clipboard.writeText(a).then(()=>{l({show:!0,position:{x:e.clientX,y:e.clientY}}),setTimeout(()=>l({show:!1,position:{x:0,y:0}}),500)}).catch(e=>{console.error("复制失败:",e)})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"ml-2 text-gray-400 hover:text-gray-600 focus:text-gray-800 transition-colors duration-200",onClick:u,title:"复制内容",disabled:c,children:(0,a.jsx)(i.g,{icon:c?n.z1G:n.jPR,className:c?"animate-spin":""})}),o.show&&(0,a.jsx)("div",{className:"absolute bg-green-500 text-white px-2 py-1 rounded shadow-lg",style:{top:o.position.y-30,left:o.position.x,zIndex:200},children:"复制成功"})]})}},68435:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,AuthProvider:()=>l});var a=s(95155),r=s(12115),i=s(76046),n=s(86828);let o=(0,r.createContext)({user_id:null,username:null,email:null,role:null,device_id:null,isAuthenticated:!1,currentPath:null,login:async()=>{throw Error("AuthProvider not found")},logout:async()=>{throw Error("AuthProvider not found")},refresh_token:async()=>{throw Error("AuthProvider not found")},changeCurrentPath:async()=>{throw Error("AuthProvider not found")}});function l(e){let{children:t}=e,s=(0,i.useRouter)(),l=(0,i.useSearchParams)(),c=(0,i.usePathname)(),[d,u]=(0,r.useState)(!0),h=["/login","/register","/forgot-password"],[x,p]=(0,r.useState)(null),[m,y]=(0,r.useState)(null),[g,f]=(0,r.useState)(null),[w,j]=(0,r.useState)(null),[v,b]=(0,r.useState)(null),[A,k]=(0,r.useState)(!1),[N,P]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(h.includes(c)){u(!1);return}E()},[c]);let E=async()=>{let e="".concat(n.J,"/auth/profile");console.log("api_url >>> ",e);try{console.log("开始刷新 token"),u(!0);let t=await fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Cache-Control":"no-cache",Pragma:"no-cache"},credentials:"include",signal:AbortSignal.timeout(8e3)});if(t.ok){let e=await t.json();p(e.user_id),y(e.device_id),f(e.username),j(e.email),b(e.role),k(!0)}else console.log("响应不成功，重定向到登录页"),k(!1),s.replace("/login")}catch(t){console.error("刷新 token 详细错误:",{error:t,message:t instanceof Error?t.message:"未知错误",api_url:e}),k(!1),s.replace("/login")}finally{u(!1)}},S=async(e,t)=>{console.log("login >>> ",e,t);let a=await fetch("".concat(n.J,"/auth/login"),{method:"POST",credentials:"include",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(!a.ok)throw Error((await a.json()).detail||"Login failed");let r=await a.json();console.log("POST auth/login >>> ",r),p(r.user_id),y(r.device_id),f(r.username),j(r.email),b(r.role),k(!0);let i=l.get("from")||"/chat";s.replace(i)},_=async()=>{await fetch("".concat(n.J,"/auth/logout"),{method:"POST",credentials:"include"}),p(null),f(null),j(null),b(null),k(!1),s.replace("/login")},I=async e=>{P(e)};return d&&!h.includes(c)?(0,a.jsx)("div",{children:"Loading..."}):(0,a.jsx)(o.Provider,{value:{user_id:x,device_id:m,username:g,email:w,role:v,isAuthenticated:A,login:S,logout:_,refresh_token:E,currentPath:N,changeCurrentPath:I},children:t})}function c(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},86828:(e,t,s)=>{"use strict";s.d(t,{J:()=>r,t:()=>i});var a=s(85521);let r="/api",i=e=>{e.response&&401===e.response.status?console.log("未授权，重定向到登录页"):console.log("API 请求错误:",e),a.default.push("/login")}}},e=>{var t=t=>e(e.s=t);e.O(0,[779,299,563,420,804,256,19,694,269,889,432,592,331,271,30,173,473,376,358],()=>t(83571)),_N_E=e.O()}]);