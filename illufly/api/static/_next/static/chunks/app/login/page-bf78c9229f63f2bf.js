(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520,792],{1226:()=>{},841:(e,t,r)=>{Promise.resolve().then(r.bind(r,2693))},2693:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(5155),a=r(2115),l=r(6046),n=r(3201);function o(){let[e,t]=(0,a.useState)(""),[r,o]=(0,a.useState)(""),[i,c]=(0,a.useState)(""),{login:u}=(0,n.A)(),d=(0,l.useRouter)(),[h,p]=(0,a.useState)(!1),m=async t=>{t.preventDefault(),c(""),p(!0);try{await u(e,r)&&d.push("/chat")}catch(e){e.response&&e.response.data&&e.response.data.message?c(e.response.data.message):c("进入梦幻岛失败，请稍后再试")}finally{p(!1)}};return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,s.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md",children:[(0,s.jsx)("h1",{className:"text-3xl sm:text-3xl md:text-4xl lg:text-4xl font-bold mb-6 text-center",children:"✨\uD83E\uDD8B 欢迎魔法师归来"}),(0,s.jsxs)("form",{onSubmit:m,children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-gray-700 mb-2",children:"邮箱"}),(0,s.jsx)("input",{type:"email",id:"email",value:e,onChange:e=>t(e.target.value),required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"输入您的邮箱"})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{htmlFor:"password",className:"block text-gray-700 mb-2",children:"密码"}),(0,s.jsx)("input",{type:"password",id:"password",value:r,onChange:e=>o(e.target.value),required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"输入您的密码"})]}),i&&(0,s.jsx)("p",{className:"text-red-500 mb-4",children:i}),(0,s.jsx)("button",{type:"submit",disabled:h,className:"w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors duration-300 ".concat(h?"opacity-50 cursor-not-allowed":""),children:h?"传送中...":"进入梦幻岛"})]}),(0,s.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,s.jsx)("a",{href:"#",className:"text-blue-500 hover:text-blue-700 underline",children:"忘记密码？"}),(0,s.jsx)("a",{href:"/register",className:"text-blue-500 hover:text-blue-700 underline",children:"注册新账户"})]})]})})}},3201:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,O:()=>i});var s=r(5155),a=r(6046),l=r(2115),n=r(2492);let o=(0,l.createContext)(),i=e=>{let{children:t}=e,[r,i]=(0,l.useState)(null),[c,u]=(0,l.useState)(!0),d=(0,a.useRouter)(),h=(0,a.usePathname)();(0,l.useEffect)(()=>{(async()=>{if("/login"===h){u(!1);return}try{let e=await (0,n.im)();e.username?i(e):d.push("/login")}catch(e){i(null),d.push("/login")}finally{u(!1)}})()},[h]);let p=async(e,t)=>{try{let r=await (0,n.iD)(e,t);return r&&i(r),r}catch(e){throw console.error("登录失败:",e),e}},m=async()=>{try{i(null),await (0,n.ri)()}catch(e){console.error("登出错误:",e)}d.push("/login")},x=async()=>{try{await (0,n.Be)()}catch(e){console.error("刷新令牌错误:",e)}},y=async()=>{try{let e=await (0,n.im)();i(e)}catch(e){console.error("获取用户信息错误:",e)}};return(0,s.jsx)(o.Provider,{value:{user:r,loading:c,login:p,logout:m,refreshToken:x,fetchUser:y},children:t})},c=()=>(0,l.useContext)(o)},5370:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(2651),a=r(6828);let l=s.A.create({baseURL:a.J,withCredentials:!0});l.interceptors.response.use(e=>e,async e=>{let t=e.config;if(e.response&&401===e.response.status&&!t._retry){t._retry=!0;try{return await l.post("/api/auth/refresh-token",{},{withCredentials:!0}),l(t)}catch(e){return(0,a.t)(e),Promise.reject(e)}}return e.response&&403===e.response.status&&console.error("访问被拒绝:",e),(0,a.t)(e),Promise.reject(e)});let n=l},2492:(e,t,r)=>{"use strict";r.d(t,{Be:()=>o,iD:()=>a,im:()=>n,ri:()=>l});var s=r(5370);let a=async(e,t)=>{try{let r=new URLSearchParams;r.append("grant_type","password"),r.append("username",e),r.append("password",t);let a=await s.A.post("/api/auth/login",r,{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!a.request.withCredentials)return alert("请检查浏览器隐私设置：客户端无法保存 Cookie 导致登录失败！"),null;return a.data}catch(e){throw console.error("登录失败:",e.response?e.response.data:e.message),Error("登录失败，请检查您的凭据并重试。")}},l=async()=>{try{await s.A.post("/api/auth/logout",{},{withCredentials:!0})}catch(e){if(e.response&&401===e.response.status)return;throw Error("登出失败")}},n=async()=>{try{return(await s.A.get("/api/auth/profile")).data}catch(e){console.log("获取用户信息失败")}},o=async()=>{try{await s.A.post("/api/auth/refresh-token",{},{withCredentials:!0})}catch(e){console.log("刷新令牌失败")}}},6828:(e,t,r)=>{"use strict";r.d(t,{J:()=>a,t:()=>l});var s=r(5521);let a="http://localhost:8001",l=e=>{e.response&&401===e.response.status?console.log("未授权，重定向到登录页"):console.log("API 请求错误:",e),s.default.push("/login")}}},e=>{var t=t=>e(e.s=t);e.O(0,[779,420,804,19,622,694,432,592,331,271,30,519,408,473,376,358],()=>t(841)),_N_E=e.O()}]);