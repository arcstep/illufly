(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72,792],{41226:()=>{},31843:(e,t,l)=>{Promise.resolve().then(l.bind(l,49389))},49389:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>a});var r=l(95155),n=l(12115),s=l(68435);function a(){let e=(0,s.A)(),[t,l]=(0,n.useState)(""),[a,o]=(0,n.useState)(""),[i,u]=(0,n.useState)(""),[c,d]=(0,n.useState)(!1),h=async l=>{l.preventDefault(),u(""),d(!0);try{await e.login(t,a)}catch(e){console.log("err >>> ",e),e.response&&e.response.data&&e.response.data.message?u(e.response.data.message):u("进入梦幻岛失败，请稍后再试")}finally{d(!1)}};return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,r.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md",children:[(0,r.jsx)("h1",{className:"text-3xl sm:text-3xl md:text-4xl lg:text-4xl font-bold mb-6 text-center",children:"✨\uD83E\uDD8B 欢迎魔法师归来"}),(0,r.jsxs)("form",{onSubmit:h,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"username",className:"block text-gray-700 mb-2",children:"账户"}),(0,r.jsx)("input",{type:"text",id:"username",value:t,onChange:e=>l(e.target.value),required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"输入您的账户"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-gray-700 mb-2",children:"密码"}),(0,r.jsx)("input",{type:"password",id:"password",value:a,onChange:e=>o(e.target.value),required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"输入您的密码"})]}),i&&(0,r.jsx)("p",{className:"text-red-500 mb-4",children:i}),(0,r.jsx)("button",{type:"submit",disabled:c,className:"w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors duration-300 ".concat(c?"opacity-50 cursor-not-allowed":""),children:c?"传送中...":"进入梦幻岛"})]}),(0,r.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,r.jsx)("a",{href:"#",className:"text-blue-500 hover:text-blue-700 underline",children:"忘记密码？"}),(0,r.jsx)("a",{href:"/register",className:"text-blue-500 hover:text-blue-700 underline",children:"注册新账户"})]})]})})}},68435:(e,t,l)=>{"use strict";l.d(t,{A:()=>u,AuthProvider:()=>i});var r=l(95155),n=l(12115),s=l(76046),a=l(86828);let o=(0,n.createContext)({user_id:null,username:null,email:null,role:null,device_id:null,isAuthenticated:!1,currentPath:null,login:async()=>{throw Error("AuthProvider not found")},logout:async()=>{throw Error("AuthProvider not found")},refresh_token:async()=>{throw Error("AuthProvider not found")},changeCurrentPath:async()=>{throw Error("AuthProvider not found")}});function i(e){let{children:t}=e,l=(0,s.useRouter)(),i=(0,s.useSearchParams)(),u=(0,s.usePathname)(),[c,d]=(0,n.useState)(!0),h=["/login","/register","/forgot-password"],[m,g]=(0,n.useState)(null),[p,f]=(0,n.useState)(null),[x,b]=(0,n.useState)(null),[v,y]=(0,n.useState)(null),[w,j]=(0,n.useState)(null),[S,N]=(0,n.useState)(!1),[P,_]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(h.includes(u)){d(!1);return}A()},[u]);let A=async()=>{let e="".concat(a.J,"/auth/profile");console.log("api_url >>> ",e);try{console.log("开始刷新 token"),d(!0);let t=await fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Cache-Control":"no-cache",Pragma:"no-cache"},credentials:"include",signal:AbortSignal.timeout(8e3)});if(t.ok){let e=await t.json();g(e.user_id),f(e.device_id),b(e.username),y(e.email),j(e.role),N(!0)}else console.log("响应不成功，重定向到登录页"),N(!1),l.replace("/login")}catch(t){console.error("刷新 token 详细错误:",{error:t,message:t instanceof Error?t.message:"未知错误",api_url:e}),N(!1),l.replace("/login")}finally{d(!1)}},E=async(e,t)=>{console.log("login >>> ",e,t);let r=await fetch("".concat(a.J,"/auth/login"),{method:"POST",credentials:"include",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(!r.ok)throw Error((await r.json()).detail||"Login failed");let n=await r.json();console.log("POST auth/login >>> ",n),g(n.user_id),f(n.device_id),b(n.username),y(n.email),j(n.role),N(!0);let s=i.get("from")||"/chat";l.replace(s)},k=async()=>{await fetch("".concat(a.J,"/auth/logout"),{method:"POST",credentials:"include"}),g(null),b(null),y(null),j(null),N(!1),l.replace("/login")},C=async e=>{_(e)};return c&&!h.includes(u)?(0,r.jsx)("div",{children:"Loading..."}):(0,r.jsx)(o.Provider,{value:{user_id:m,device_id:p,username:x,email:v,role:w,isAuthenticated:S,login:E,logout:k,refresh_token:A,currentPath:P,changeCurrentPath:C},children:t})}function u(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},86828:(e,t,l)=>{"use strict";l.d(t,{J:()=>n,t:()=>s});var r=l(85521);let n="/api",s=e=>{e.response&&401===e.response.status?console.log("未授权，重定向到登录页"):console.log("API 请求错误:",e),r.default.push("/login")}}},e=>{var t=t=>e(e.s=t);e.O(0,[779,299,563,420,804,256,19,694,269,889,432,592,331,271,30,173,473,376,358],()=>t(31843)),_N_E=e.O()}]);