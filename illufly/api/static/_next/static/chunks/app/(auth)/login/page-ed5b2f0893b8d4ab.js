(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72,792],{1226:()=>{},1843:(e,t,l)=>{Promise.resolve().then(l.bind(l,9389))},9389:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>o});var s=l(5155),r=l(2115),n=l(6046),a=l(8435);function o(){let e=(0,a.A)(),[t,l]=(0,r.useState)(""),[o,u]=(0,r.useState)(""),[i,c]=(0,r.useState)(""),d=(0,n.useRouter)(),[h,m]=(0,r.useState)(!1),f=async l=>{l.preventDefault(),c(""),m(!0);try{let l=await e.login(t,o);console.log("user >>> ",l),l&&d.push("/chat")}catch(e){console.log("err >>> ",e),e.response&&e.response.data&&e.response.data.message?c(e.response.data.message):c("进入梦幻岛失败，请稍后再试")}finally{m(!1)}};return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,s.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md",children:[(0,s.jsx)("h1",{className:"text-3xl sm:text-3xl md:text-4xl lg:text-4xl font-bold mb-6 text-center",children:"✨\uD83E\uDD8B 欢迎魔法师归来"}),(0,s.jsxs)("form",{onSubmit:f,children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"username",className:"block text-gray-700 mb-2",children:"账户"}),(0,s.jsx)("input",{type:"text",id:"username",value:t,onChange:e=>l(e.target.value),required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"输入您的账户"})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{htmlFor:"password",className:"block text-gray-700 mb-2",children:"密码"}),(0,s.jsx)("input",{type:"password",id:"password",value:o,onChange:e=>u(e.target.value),required:!0,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"输入您的密码"})]}),i&&(0,s.jsx)("p",{className:"text-red-500 mb-4",children:i}),(0,s.jsx)("button",{type:"submit",disabled:h,className:"w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors duration-300 ".concat(h?"opacity-50 cursor-not-allowed":""),children:h?"传送中...":"进入梦幻岛"})]}),(0,s.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,s.jsx)("a",{href:"#",className:"text-blue-500 hover:text-blue-700 underline",children:"忘记密码？"}),(0,s.jsx)("a",{href:"/register",className:"text-blue-500 hover:text-blue-700 underline",children:"注册新账户"})]})]})})}},8435:(e,t,l)=>{"use strict";l.d(t,{A:()=>i,AuthProvider:()=>u});var s=l(5155),r=l(2115),n=l(6046),a=l(6828);let o=(0,r.createContext)({user_id:null,username:null,email:null,role:null,device_id:null,isAuthenticated:!1,login:async()=>{throw Error("AuthProvider not found")},logout:async()=>{throw Error("AuthProvider not found")},refresh_token:async()=>{throw Error("AuthProvider not found")}});function u(e){let{children:t}=e,l=(0,n.useRouter)(),u=(0,n.useSearchParams)(),i=(0,n.usePathname)(),c=["/login","/register","/forgot-password"],[d,h]=(0,r.useState)(null),[m,f]=(0,r.useState)(null),[g,p]=(0,r.useState)(null),[x,b]=(0,r.useState)(null),[v,w]=(0,r.useState)(null),[y,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{c.includes(i)||N()},[i]);let N=async()=>{let e=await fetch("".concat(a.J,"/auth/profile"),{credentials:"include"});if(e.ok){let t=await e.json();console.log(t),h(t.user_id),f(t.device_id),p(t.username),b(t.email),w(t.role),j(!0)}else l.push("/login")},_=async(e,t)=>{console.log("login >>> ",e,t);let s=await fetch("".concat(a.J,"/auth/login"),{method:"POST",credentials:"include",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(!s.ok)throw Error((await s.json()).detail||"Login failed");let r=await s.json();h(r.user_id),f(r.device_id),p(r.username),b(r.email),w(r.role),j(!0);let n=u.get("from")||"/";l.replace(n)},S=async()=>{await fetch("".concat(a.J,"/auth/logout"),{method:"POST",credentials:"include"}),h(null),p(null),b(null),w(null),j(!1),l.replace("/login")};return(0,s.jsx)(o.Provider,{value:{user_id:d,device_id:m,username:g,email:x,role:v,isAuthenticated:y,login:_,logout:S,refresh_token:N},children:t})}function i(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6828:(e,t,l)=>{"use strict";l.d(t,{J:()=>r,t:()=>n});var s=l(5521);let r=l(2818).env.NEXT_PUBLIC_API_BASE_URL||"/api",n=e=>{e.response&&401===e.response.status?console.log("未授权，重定向到登录页"):console.log("API 请求错误:",e),s.default.push("/login")}}},e=>{var t=t=>e(e.s=t);e.O(0,[779,420,804,19,622,694,432,592,331,271,30,519,408,473,376,358],()=>t(1843)),_N_E=e.O()}]);