(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177,792],{1226:()=>{},6490:(e,t,r)=>{Promise.resolve().then(r.bind(r,7974))},7974:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var s=r(5155);r(347);var a=r(3201);function n(e){let{children:t}=e;return(0,s.jsxs)("html",{lang:"zh-CN",children:[(0,s.jsx)("head",{}),(0,s.jsx)("body",{children:(0,s.jsx)(a.O,{children:(0,s.jsx)("main",{children:t})})})]})}},3201:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,O:()=>i});var s=r(5155),a=r(6046),n=r(2115),o=r(2492);let l=(0,n.createContext)(),i=e=>{let{children:t}=e,[r,i]=(0,n.useState)(null),[c,u]=(0,n.useState)(!0),h=(0,a.useRouter)(),p=(0,a.usePathname)();(0,n.useEffect)(()=>{(async()=>{if("/login"===p){u(!1);return}try{let e=await (0,o.im)();e.username?i(e):h.push("/login")}catch(e){i(null),h.push("/login")}finally{u(!1)}})()},[p]);let d=async(e,t)=>{try{let r=await (0,o.iD)(e,t);return r&&i(r),r}catch(e){throw console.error("登录失败:",e),e}},w=async()=>{try{i(null),await (0,o.ri)()}catch(e){console.error("登出错误:",e)}h.push("/login")},y=async()=>{try{await (0,o.Be)()}catch(e){console.error("刷新令牌错误:",e)}},f=async()=>{try{let e=await (0,o.im)();i(e)}catch(e){console.error("获取用户信息错误:",e)}};return(0,s.jsx)(l.Provider,{value:{user:r,loading:c,login:d,logout:w,refreshToken:y,fetchUser:f},children:t})},c=()=>(0,n.useContext)(l)},5370:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(2651),a=r(6828);let n=s.A.create({baseURL:a.J,withCredentials:!0});n.interceptors.response.use(e=>e,async e=>{let t=e.config;if(e.response&&401===e.response.status&&!t._retry){t._retry=!0;try{return await n.post("/api/auth/refresh-token",{},{withCredentials:!0}),n(t)}catch(e){return(0,a.t)(e),Promise.reject(e)}}return e.response&&403===e.response.status&&console.error("访问被拒绝:",e),(0,a.t)(e),Promise.reject(e)});let o=n},2492:(e,t,r)=>{"use strict";r.d(t,{Be:()=>l,iD:()=>a,im:()=>o,ri:()=>n});var s=r(5370);let a=async(e,t)=>{try{let r=new URLSearchParams;r.append("grant_type","password"),r.append("username",e),r.append("password",t);let a=await s.A.post("/api/auth/login",r,{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!a.request.withCredentials)return alert("请检查浏览器隐私设置：客户端无法保存 Cookie 导致登录失败！"),null;return a.data}catch(e){throw console.error("登录失败:",e.response?e.response.data:e.message),Error("登录失败，请检查您的凭据并重试。")}},n=async()=>{try{await s.A.post("/api/auth/logout",{},{withCredentials:!0})}catch(e){if(e.response&&401===e.response.status)return;throw Error("登出失败")}},o=async()=>{try{return(await s.A.get("/api/auth/profile")).data}catch(e){console.log("获取用户信息失败")}},l=async()=>{try{await s.A.post("/api/auth/refresh-token",{},{withCredentials:!0})}catch(e){console.log("刷新令牌失败")}}},6828:(e,t,r)=>{"use strict";r.d(t,{J:()=>a,t:()=>n});var s=r(5521);let a="http://localhost:8001",n=e=>{e.response&&401===e.response.status?console.log("未授权，重定向到登录页"):console.log("API 请求错误:",e),s.default.push("/login")}},347:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[690,779,420,804,19,622,694,432,592,331,271,30,519,408,473,376,358],()=>t(6490)),_N_E=e.O()}]);